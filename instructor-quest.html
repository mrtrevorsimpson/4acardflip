<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Instructor Quest â€” Canvas Test Fix</title>
<style>
  :root{ --bg:#0c0f17; --line:#243046; --text:#e5e7eb; --chip:#0009; }
  html,body{margin:0;height:100%;background:var(--bg);color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
  /* Header */
  header{display:flex;align-items:center;gap:.75rem;padding:.6rem .8rem;
    border-bottom:1px solid var(--line);
    background:linear-gradient(180deg,#121a2a,#0e1422);}
  header img.logo{height:32px}
  header h1{margin:0;font-size:1.05rem;font-weight:800}
  header .grow{flex:1}
  header .btn{background:#141c2c;border:1px solid #23304a;color:var(--text);
    padding:.4rem .6rem;border-radius:.5rem;cursor:pointer;font-weight:700;letter-spacing:.3px}

  /* Layout â€” give the game a definite height no matter what */
  .wrap{display:grid;grid-template-rows:auto 1fr;height:100vh;}
  #game{position:relative;background:#000;min-height:480px; /* fallback */
        height:calc(100vh - 64px);} /* rough header height (safe) */
  #view{display:block;width:100%;height:100%}

  /* HUD + error badge */
  .hud{position:absolute;left:0;right:0;top:0;display:flex;gap:.5rem;
       padding:.4rem .6rem;pointer-events:none}
  .chip{pointer-events:auto;background:var(--chip);border:1px solid #334155;
        color:#e2e8f0;border-radius:.45rem;padding:.25rem .45rem;font-size:.85rem}
  #err{position:absolute;right:.6rem;top:.6rem;background:#7f1d1d; border:1px solid #ef4444;}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <img class="logo" src="assiniboinelogo.PNG" alt="Assiniboine" onerror="this.style.display='none'">
    <h1>Instructor Quest</h1>
    <div class="grow"></div>
    <button class="btn" id="audioBtn">ðŸ”ˆ Audio</button>
  </header>

  <main id="game" aria-label="Canvas area">
    <canvas id="view" width="960" height="540"></canvas>
    <div class="hud">
      <div class="chip">W/A/S/D to move â€¢ Mouse to look</div>
      <div id="err" class="chip" style="display:none"></div>
    </div>
  </main>
</div>

<script>
/* ------------- On-page error reporter (so we see problems immediately) ------------- */
(function(){
  const err = document.getElementById('err');
  window.addEventListener('error', e=>{
    err.style.display = 'block';
    err.textContent = 'JS error: ' + (e.message||'unknown');
  });
})();

/* ------------- Canvas + sizing (with hard fallbacks) ------------- */
const canvas = document.getElementById('view');
const ctx = canvas.getContext('2d');

function sizeCanvas(){
  const game = document.getElementById('game');
  let w = game.clientWidth || window.innerWidth || 960;
  let h = game.clientHeight || (window.innerHeight - 64) || 540;

  // Extra safety: if h is suspiciously small/0, force 560px
  if (!h || h < 200) h = 560;

  canvas.width  = w;
  canvas.height = h;

  // Draw a very obvious test pattern so we can SEE rendering is alive
  ctx.fillStyle = '#0ea5a5'; // teal
  ctx.fillRect(0,0,w,h/2);
  ctx.fillStyle = '#0b1430'; // navy
  ctx.fillRect(0,h/2,w,h/2);

  // Simple â€œcorridor stripesâ€ so you can tell the loop is running
  ctx.fillStyle = 'rgba(255,255,255,.08)';
  for (let i=0;i<20;i++){
    const x = Math.floor((i/20)*w);
    ctx.fillRect(x, (h/2)-2, 2, 4);
  }
}
window.addEventListener('load', sizeCanvas);
window.addEventListener('resize', sizeCanvas);

/* ------------- Minimal render loop (proves animation works) ------------- */
let t0 = performance.now();
function loop(t){
  const dt = Math.min(0.05, (t - t0)/1000); t0 = t;
  // animate a faint moving bar so you can see itâ€™s alive
  const w = canvas.width, h = canvas.height;
  const y = Math.floor(h/2 + Math.sin(t/600)* (h/4));
  ctx.fillStyle = 'rgba(255,255,255,.06)';
  ctx.fillRect(0,0,w,h);
  // redraw the test background
  ctx.fillStyle = '#0ea5a5'; ctx.fillRect(0,0,w,h/2);
  ctx.fillStyle = '#0b1430'; ctx.fillRect(0,h/2,w,h/2);
  ctx.fillStyle = 'rgba(255,255,255,.1)';
  ctx.fillRect(0, y, w, 6);
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ------------- Audio toggle (stub) ------------- */
document.getElementById('audioBtn').onclick = function(){
  this.textContent = this.textContent.includes('ðŸ”ˆ') ? 'ðŸ”Š Audio' : 'ðŸ”ˆ Audio';
};
</script>
</body>
</html>
